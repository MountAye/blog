
<!DOCTYPE html>
<html lang="zh-CN" class="scrollbar-hidden">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    

<title>.sh | 在 VirutalBox 中安装 Arch Linux | 阿掖山</title>
<link rel="shortcut icon" href="https://mountaye.github.io/blog/favicon.ico" >
<link rel="canonical" href="https://mountaye.github.io/blog/articles/Arch-Linux-in-VirtualBox" />
<meta name="generator" content="Jekyll v4.3.2" />
<meta name="author" content="MountAye" />
<meta name="description" content="这是一篇速记，相当于实验的原始记录。日后有可能根据这些记录，整理出一些心得体会，或者全流程的教程。" />
<meta property="og:title" content=".sh | 在 VirutalBox 中安装 Arch Linux" />
<meta property="og:locale" content="zh-CN" />
<meta property="og:description" content="" />
<meta property="og:url" content="https://mountaye.github.io/blog/articles/Arch-Linux-in-VirtualBox" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-03 00:00:00 -0500" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content=".sh | 在 VirutalBox 中安装 Arch Linux" />
<script type="application/ld+json">
    {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MountAye"},"dateModified":"","datePublished":"2019-09-03","description":"这是一篇速记，相当于实验的原始记录。日后有可能根据这些记录，整理出一些心得体会，或者全流程的教程。","headline":"这是一篇速记，相当于实验的原始记录。日后有可能根据这些记录，整理出一些心得体会，或者全流程的教程。","mainEntityOfPage":{"@type":"WebPage","@id":"https://mountaye.github.io/blog/articles/Arch-Linux-in-VirtualBox"},"url":"https://mountaye.github.io/blog/articles/Arch-Linux-in-VirtualBox"}
</script>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3X9B5LN42L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3X9B5LN42L');
</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,400;0,8..60,700;1,8..60,400;1,8..60,700&display=swap" rel="stylesheet">
<script>
  (function(d) {
    var config = {
      kitId: 'oau8puo',
      scriptTimeout: 3000,
      async: true
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script>

    <link rel="stylesheet" href="/blog/assets/css/main.css">
    <script src="/blog/assets/js/main.js"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <div id="layout-all">
      <aside id="layout-left">
        <a class="left-avatar"
           href="https://mountaye.github.io/blog/"
        >
          <div id="avatar"></div>
          <div id="sitename">阿掖山</div>
        </a>
        <div id="left-middle">
          <div class="fade-out-left"></div>
          
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              changeQuote();
            })
          </script>
          <div class="side-vertical scrollbar-hidden">
            <p><span id="quote-line">智力活动是一种生活态度</span></p> <!-- This id is used by js --> 
            <p>——<span id="quote-author">阿掖山·一个博客</span></p>   <!-- This id is used by js --> 
          </div>
          
        </div>
        <footer id="left-footer" class="side-vertical">
          <div id="social-icons">
            <a href="/blog/feed.xml" class="icon-Popular_RSS"></a>
            <a href="https://www.github.com/MountAye" class="icon-Popular_GitHub"></a>
            <a href="https://www.twitter.com/MountAye" class="icon-Popular_Twitter"></a>
            <a href="https://github.com/MountAye/comments/discussions/categories/blog" class="icon-Popular_mail" style="font-size: 13px;"></a>
          </div>
          <p>阿掖山 &copy; 2024
          <br>Rights Reserved
          <br>Theme by <a href="https://www.github.com/MountAye" style="font-size: inherit; text-decoration: none; color: #3C70C6;">MountAye</a></p>
        </footer>
      </aside> 
      <div id="layout-mid">
        <header id="header"> <!-- This id is used by js --> 
          <h1 id="header-title">阿掖山.sh | 在 VirutalBox 中安装 Arch Linux</h1>
          <div id="toc-button" class="changable-icon" onclick="tocButton(this)">
            <div class="bar1"></div><div class="bar2"></div><div class="bar3"></div>
          </div>
          <div id="toc-dropdown-container" class="dropdown-content">
            <div id="toc-dropdown"><!-- This id is used by js --></div> 
          </div>
        </header>
      
        <div id="title-banner" class="written">
          
          <h1>.sh | 在 VirutalBox 中安装 Arch Linux</h1>
          <div id="author-card">
            <div id="author-avatar" style='background-image: url("/blog/assets/img/before_h2.png");'></div>
            <div id="author-texts">
              <p><strong>MountAye</strong></p>
              <p>Sep 3, 2019</p>
            </div>
          </div>
          <hr>  
        </div>
      
        <main class="written">
  <blockquote>
  <p>这是一篇速记，相当于实验的原始记录。日后有可能根据这些记录，整理出一些心得体会，或者全流程的教程。</p>
</blockquote>

<p>第四代树莓派（<a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/">Raspberry Pi 4</a>）刚刚推出的时候，脑子一热买了一台。作为一台计算机，只用原装的操作系统有点咸鱼了，所以打算安装 Linux 的一款发行版。既然要追求刺激，那就贯彻到底咯，于是就决定挑战一下 Arch Linux。 <del>（反正早晚也要吃灰）</del></p>

<p>既然要挑战一个很有挑战性的操作系统，那么先在虚拟机里试试水就很有必要了。（后来才发现用这个虚拟机往树莓派里写操作系统，也是官方比较推荐的一种安装方式。）于是就开始了这篇速记中的一系列折腾。</p>

<h2 id="我的硬件和软件配置">我的硬件和软件配置</h2>

<ul>
  <li><strong>硬件</strong>：蓝厂 CPU、绿厂显卡、2*8 GiB 内存、小 SSD + 大 HDD 硬盘、iTX 主板，机龄不到两年，日常可以流畅使用。</li>
  <li><strong>物理机操作系统</strong>：Windows 10 Pro</li>
  <li><strong>虚拟机控制软件</strong>：VirtualBox 6.10，短暂用过 5.12 版本</li>
  <li><strong>虚拟机镜像文件</strong>：Arch Linux 2019.08.01, Windows 10, Fedora 30 Workstation</li>
</ul>

<h2 id="虚拟机托管软件-virtualbox">虚拟机托管软件 VirtualBox</h2>

<p>可以看一下编程随想的博客里的 <a href="https://program-think.blogspot.com/2012/10/system-vm-0.html">系列文章</a>。</p>

<p>我的手头一直有虚拟机托管软件，但是没有编程随想那样的需求，平时几乎用不到。（用虚拟机学 Linux？你可拉倒吧）不过之前很轻松地装过一些 Linux 的发行版，主要是 Fedora，所以没觉得这部分会有什么问题，直接开始了主线任务：下载 Arch Linux 的安装 ISO 镜像、检查校验和（FCIV，教程可以看 <a href="https://program-think.blogspot.com/2013/02/file-integrity-check.html">这里</a>）、按照官网 <a href="https://wiki.archlinux.org/index.php/Installation_guide">安装指南</a>（<a href="https://wiki.archlinux.org/index.php/Installation_guide_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">中文</a>）操作，然后发现虚拟机连不上网 :-(</p>

<h3 id="问题虚拟机无法通过-nat-或-nat-network-模式联网">问题：虚拟机无法通过 NAT 或 NAT Network 模式联网</h3>

<p>具体表现为 <code class="language-plaintext highlighter-rouge">ping www.google.com</code> 报错：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ping archlinux.org
<span class="c"># Temporary failure in name resolution</span>
</code></pre></div></div>

<p>此时的网络设置没有修改过，就是几乎没有可选参数的 NAT 模式。</p>

<p>第一反应当然是把报错的信息直接复制粘贴到 Google 里，然后看到了 <a href="https://bbs.archlinux.org/viewtopic.php?id=237461">这个帖子</a>。</p>

<p>回答用一种很有礼貌的方式表述了 RTFM，并给出了官方的 <a href="https://wiki.archlinux.org/index.php/Network_configuration">Network Configuration 页面</a>。</p>

<p>按照这个页面的步骤，因为我的 ISP 给的是动态的 IP，需要用DHCP，DHCP 是啥我都不知道，搞得我跪着下载了编程随想书单里的《Richard Stevens TCP-IP 详解》，解压后看着 3 卷一百多个 PDF 文件，默默关上了资源管理器……</p>

<p>继续变换关键词搜索解决方案，在这期间改动过防火墙设置，又重置了一次；重装了两次旧版本 VirtualBox，因为第一次重装忘记删除配置信息（Windows 10 Pro 在 <code class="language-plaintext highlighter-rouge">%userprofile%\.virtualbox</code>，见<a href="https://superuser.com/a/1429931">这个帖子</a>）；另外装了 Windows 10 和 Fedora 30 两个虚拟机；找来一个玩过 VirtualBox 而且打包票能解决问题的同学。确定了和虚拟机中的操作系统无关，VirtualBox 的 Bridge 桥接模式是可以联网的，但是总不能放任虚拟机的重要联网功能残废着啊 <del>（何况 NAT 模式在多重代理中不可或缺）</del>，还是一筹莫展。</p>

<p>就在折腾了这么几天之后，Windows 推送了一次更新，神奇的一幕发生了！更新之后，不论是 NAT 还是 NAT Network 模式，虚拟机都能正常上网，所以，可能真的是“天下本无事，庸人自扰之”吧……</p>

<p><strong>解决方法：<del>吃饭睡觉打豆豆</del></strong></p>

<h2 id="安装-arch-linux">安装 Arch Linux</h2>

<p>继续按照官方指南进行安装，不得不说这份指南写的真的不好，至少对于新手是不友好的。一个典型的例子就是下面这句：</p>

<blockquote>
  <p>你需要安装 Linux 引导程序以在安装后启动系统，你可以使用的的引导程序在 <a href="">启动加载器</a> 中，请选择一个并且安装并配置它，比如 <a href="">GRUB</a>。</p>
</blockquote>

<p>你该怎么办？公布一下正确答案：点击 <code class="language-plaintext highlighter-rouge">GRUB</code> 那个链接，在一众分类中找到适用于你的计算机配置的那一节，目力忽略各种介绍，找到那一两行有用的命令。ε=( o｀ω′)ノ</p>

<p>反正单看这一句，以我的理解能力，我是没办法正常通关，于是就有了下面硬盘格式化的问题。</p>

<h3 id="问题硬盘格式化不正确">问题：硬盘格式化不正确</h3>

<p>我是用 fdisk 进行的硬盘分区，在正常模式之下似乎找不到选择分区类型的选项，所以我的 EFI 分区也被当作了 Linux 文件系统，所以在很多个步骤之后报错，具体的报错信息已经不记得了。</p>

<p>还好在编程随想的博客的评论区里见到过萌狼，一个 Arch Linux 用户，顺手去他家的博客逛了逛，知道他写过一系列关于 Arch 的博客。所以找到了《给 GNU/Linux 萌新的 Arch Linux 安装指南》，于是直接重建了一个空白虚拟机，按照新教程的流程走了一遍。</p>

<p><strong>解决方法：看<a href="https://blog.yoitsu.moe/arch-linux/installing_arch_linux_for_complete_newbies.html">萌狼的安装教程</a>，用 cgdisk 分区</strong></p>

<h3 id="问题开机后显示-uefi-interactive-shell">问题：开机后显示 UEFI interactive shell</h3>

<p>本以为万事大吉，结果卸载掉安装 ISO 之后开机，总是会进入 UEFI interactive shell。输入 <code class="language-plaintext highlighter-rouge">exit</code> 之后重新开始倒计时，然后再次进入这个 shell……</p>

<p>就在写这篇速记的时候，我找到了官方 wiki 的 <a href="https://wiki.archlinux.org/index.php/GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%90%AF%E5%8A%A8%E6%97%B6%E8%BF%9B%E5%85%A5%E4%BA%86%E6%95%91%E6%80%A5%E6%8E%A7%E5%88%B6%E5%8F%B0">这个条目</a>，理论上应该是针对这个问题的，但是看一下就知道，并没有提供可操作的解决方案。</p>

<p>通过 STFW，找到了这篇文章：《<a href="https://cli.ee/archlinux-virtualbox">如何在 VirtualBox 内安装 Arch Linux</a>》，里面提到这个问题是由 VirtualBox 的 UEFI 引起的，同时提供了解决方法：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Shell&gt; bcfg boot dump <span class="nt">-v</span>              <span class="c"># 查看启动的菜单</span>
Shell&gt; bcfg boot <span class="nb">rm </span>0                 <span class="c"># 删除光驱启动目录</span>
Shell&gt; fs0:                           <span class="c"># 进入 EFI 分区</span>
FS0:<span class="se">\&gt;</span> <span class="nb">ls</span>                             <span class="c"># 查看目录，可以看到 EFI 目录</span>
FS0:<span class="se">\&gt;</span> <span class="nb">mkdir </span>EFI<span class="se">\b</span>oot                 <span class="c"># 在 EFI 目录下创建子目录</span>
FS0:<span class="se">\&gt;</span> <span class="nb">ls </span>EFI                         <span class="c"># 查看 EFI 目录，确认是否已创建子目录 boot</span>
FS0:<span class="se">\&gt;</span> <span class="nb">cp </span>EFI<span class="se">\g</span>rub<span class="se">\g</span>rubx64.efi EFI<span class="se">\b</span>oot<span class="se">\b</span>ootx64.efi <span class="c"># 复制 efi 文件并重命名</span>
FS0:<span class="se">\&gt;</span> <span class="nb">exit</span>                           <span class="c"># 退出</span>
</code></pre></div></div>

<p>执行完这一步，开机之后就可以看到 GRUB 的选择操作系统的界面了，因为只安装了 Arch Linux，我们只能看到两个选项，一个 <code class="language-plaintext highlighter-rouge">Arch Linux</code> 正常启动，一个 <code class="language-plaintext highlighter-rouge">Advanced Options for Arch Linux</code>。</p>

<h3 id="问题开机后无法进入图形界面">问题：开机后无法进入图形界面</h3>

<p>本以为万事大吉，结果开机之后选择 <code class="language-plaintext highlighter-rouge">*Arch Linux</code> 选项，屏幕上只剩下两行字，然后没有其他反应。</p>

<p>同样是上网搜了一下，发现如果按下 <code class="language-plaintext highlighter-rouge">Ctrl + Atl + F2</code> 是可以进入命令行模式的，随便执行了几个命令，发现系统工作正常。用 <code class="language-plaintext highlighter-rouge">journalctl</code> 看一下系统日志，发现在最后一段里经常出现高亮的几行里面，都有 <code class="language-plaintext highlighter-rouge">drm</code> 这个关键词，再次搜索，发现是和显卡相关的。因为是在虚拟机里，所以就去 VirtualBox 里康康有啥可能会导致问题的选项。</p>

<p><strong>解决方法：在 VirtualBox 的虚拟机显示设置界面，禁用3D加速</strong></p>

<hr class="slender" />

<p>至此，所有的坑都已经踩完了，开机之后可以看到正常的登录界面，Duang~Duang~~~</p>

<p><img src="/blog/assets/photos/arch.png" alt="" /></p>
    
</main>
<div class="giscus" style="margin-bottom: 2em;">
  <script src="https://giscus.app/client.js"
          data-repo="MountAye/comments"
          data-repo-id="R_kgDOJe4FmQ"
          data-category="BLOG"
          data-category-id="DIC_kwDOJe4Fmc4CWQuC"
          data-mapping="title"
          data-strict="1"
          data-reactions-enabled="1"
          data-emit-metadata="1"
          data-input-position="bottom"
          data-theme="light"
          data-lang="zh-CN"
          data-loading="lazy"
          crossorigin="anonymous"
          async>
  </script>
</div>
<div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1920275466226790"
     crossorigin="anonymous"></script>
<!-- blog-header -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1920275466226790"
     data-ad-slot="4291489170"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div>

      </div>
      <aside id="layout-right">
        <div id="right-top">
          <div class="scrollbar-hidden">
  <div id="toc-side"> <!-- This id is used by js --></div>
  <div style="max-width: 100%; height: 300px;">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1920275466226790"
     crossorigin="anonymous"></script>
<!-- blog-toc -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1920275466226790"
     data-ad-slot="9519472530"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
  <div class="fade-out-bottom"></div>
</div>

        </div>
        <div id="right-bottom">
          <div id="right-nav-container">
            <a class="right-nav-button" href="https://mountaye.github.io/blog/history">
              <span class="material-symbols-outlined">calendar_month</span>
              <span class="right-nav-text">日期归档</span>
            </a>
            <a class="right-nav-button" href="https://mountaye.github.io/blog/topics" >
              <span class="material-symbols-outlined">bookmarks</span>
              <span class="right-nav-text">话题归档</span>
            </a>
            <a class="right-nav-button" href="/blog/articles/Arch-Linux-in-VirtualBox">
              <span class="material-symbols-outlined">language_pinyin</span>
              <span class="right-nav-text">简体中文</span>
            </a>
            <a class="right-nav-button" href="/blog/en/articles/Arch-Linux-in-VirtualBox">
              <span class="material-symbols-outlined">language_us</span>
              <span class="right-nav-text">English</span>
            </a>
          </div>
        </div>
      </aside>
    </div>
    <footer id="nav-mobile"> <!-- This id is used by js -->
      <a class="nav-mobile-item" href="https://mountaye.github.io/blog/history">
        <span class="material-symbols-outlined">calendar_month</span>
      </a>
      <a class="nav-mobile-item" href="https://mountaye.github.io/blog/topics" >
        <span class="material-symbols-outlined">bookmarks</span>
      </a>
      <a class="nav-mobile-item" href="https://mountaye.github.io/blog/"><div class="nav-mobile-avatar"></div></a>
      <a class="nav-mobile-item" href="/blog/articles/Arch-Linux-in-VirtualBox">
        <span class="material-symbols-outlined">language_pinyin</span>
      </a>
      <a class="nav-mobile-item" href="/blog/en/articles/Arch-Linux-in-VirtualBox">
        <span class="material-symbols-outlined">language_us</span>
      </a>
    </footer>
  </body>
</html>