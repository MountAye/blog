<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    

<title>.py | Python 测试笔记 | 阿掖山</title>
<link rel="shortcut icon" href="https://mountaye.github.io/blog/favicon.ico" >
<link rel="canonical" href="https://mountaye.github.io/blog/articles/Python-test-notes" />
<meta name="generator" content="Jekyll v4.3.2" />
<meta name="author" content="MountAye" />
<meta name="description" content="如题" />
<meta property="og:title" content=".py | Python 测试笔记" />
<meta property="og:locale" content="zh-CN" />
<meta property="og:description" content="" />
<meta property="og:url" content="https://mountaye.github.io/blog/articles/Python-test-notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-10-16 00:00:00 -0500" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content=".py | Python 测试笔记" />
<script type="application/ld+json">
    {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MountAye"},"dateModified":"","datePublished":"2023-10-16","description":"如题","headline":"如题","mainEntityOfPage":{"@type":"WebPage","@id":"https://mountaye.github.io/blog/articles/Python-test-notes"},"url":"https://mountaye.github.io/blog/articles/Python-test-notes"}
</script>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3X9B5LN42L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3X9B5LN42L');
</script>
    <link rel="stylesheet" href="/blog/assets/css/main.css">
    <script src="/blog/assets/js/main.js"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <div class="layout-all">
      <aside id="left" class="layout-left">
        <a class="left-avatar"
           href="https://mountaye.github.io/blog/"
        >
          <div id="avatar"></div>
          <div id="sitename">阿掖山</div>
        </a>
        <div class="left-quote">
          <div class="fade-out-left"></div>
          <div class="overflow-x side-vertical">
            <p><span id="quote-line">智力活动是一种生活态度</span></p>
            <p>——<span id="quote-author">阿掖山·一个博客</span></p>
          </div>
        </div>
        <footer class="left-footer side-vertical">
          <div id="social-icons">
            <a href="/blog/feed.xml" class="icon-Popular_RSS"></a>
            <a href="" class="icon-Popular_GitHub"></a>
            <a href="" class="icon-Popular_Twitter"></a>
            <a href="" class="icon-Popular_mail" style="font-size: 13px;"></a>
          </div>
          <p>Fading Snow <br>
             a theme by MountAye</p>
        </footer>
      </aside> 
      <!--  --> 
      <div class="layout-mid">
        <header id="header">
          <h1 id="header-title">阿掖山.py | Python 测试笔记</h1>
          <div id="toc-button" class="changable-icon dropdown-button" onclick="tocButton(this)">
            <div class="bar1"></div><div class="bar2"></div><div class="bar3"></div>
          </div>
          <div id="toc-dropdown-container" class="dropdown-content">
            <div id="toc-dropdown"></div>
          </div>
        </header>
      
        <div id="title-banner" class="written">
          
          <h1>.py | Python 测试笔记</h1>
          <div id="author-card">
            <div id="author-avatar" style='background-image: url("/blog/assets/img/before_h2.png");'></div>
            <div id="author-texts">
              <p><strong>MountAye</strong></p>
              <p>Oct 16, 2023</p>
            </div>
          </div>
          <hr>  
        </div>
      
        <main class="written">
          <h2 id="一些名词">一些名词</h2>

<h3 id="调试和测试">调试和测试</h3>

<p>调试一般是由代码的作者进行，用于自行检查程序运行过程，是否存在思路和实现不匹配的错误，调试的代码一般和程序主体写在一起，主要包括错误处理和日志记录。简单的可以用 print 和 assert，复杂的程序可以用 logging。</p>

<p>测试一般由第三方进行，测试代码和程序代码分离，写测试的人甚至不需要理解程序的具体工作原理，只关注给定的输入能否得到程序宣称的输出。</p>

<h3 id="单元测试">单元测试</h3>

<p>对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p>

<p>检验的方法是写一堆测试用例，把测试员拍脑袋想的输入交给相应的模块，看模块的输出是否正确；以及不合理的输入是否被程序识别，抛出异常。</p>

<p>单元测试全通过了不代表程序整体一定就没错误，但是单元测试通不过的程序一定有问题。</p>

<h3 id="文档测试">文档测试</h3>

<p>文档是对代码的功能介绍，其中不免要举例子，给出实例代码和相应的输出，这个过程很像是单元测试，只不过是纯嘴炮。</p>

<p>文档测试就是自动寻找文档中的示例代码，运行之后，和文档中的结果进行比对。</p>

<h3 id="集成测试">集成测试</h3>

<p>集成测试模拟用户的行为，测试各个模块之间的配合，测试结果应该保证程序可以在生产环境中工作。</p>

<h2 id="python-中的测试">Python 中的测试</h2>

<h3 id="文件结构">文件结构</h3>

<p>上一篇文章里面提到了 src-layout，在 setuptools 的官方文档里提供了<a href="https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure">一篇博客文章</a>，里面提到，这种文件结构的一个优点就是，测试代码的文件夹一般和 <code class="language-plaintext highlighter-rouge">src/</code> 而不是 package 平级，这就导致运行测试的时候只能先（在虚拟环境里）安装待测试的包，而不会无意中出现测试的代码和用户下载到的内容不同的问题。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project_name&gt;
├── LICENSE
├── pyproject.toml
├── README.md
├── src/
│   └── &lt;package_name&gt;/
│       ├── __init__.py
│       └── example.py
└── tests/
</code></pre></div></div>

<h3 id="单元测试unittest">单元测试·<code class="language-plaintext highlighter-rouge">unittest</code></h3>

<p><code class="language-plaintext highlighter-rouge">unittest</code> 是 Python 自带的单元测试库。</p>

<p>测试脚本的内容基本如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import unittest

class TestName1(unittest.TestCase):

    def test_sum(self):
        self.assertEqual(sum([1, 2, 3]), 6, "Should be 6")

    def test_sum_tuple(self):
        self.assertEqual(sum((1, 2, 2)), 6, "Should be 6")

class TestName2(unittest.TestCase):

    def test_sum(self):
        self.assertEqual(sum([1, 2, 3]), 6, "Should be 6")

    def test_sum_tuple(self):
        self.assertEqual(sum((1, 2, 2)), 6, "Should be 6")

if __name__ == '__main__':
    unittest.main()
</code></pre></div></div>

<ul>
  <li>测试用例包装在一个 class 里面，这个 class 继承自 <code class="language-plaintext highlighter-rouge">unittest.TestCase</code></li>
  <li>所有测试方法名字以 “test” 开头，能测试的性质有限，都是类自带的方法，以 <code class="language-plaintext highlighter-rouge">self.</code> 开头。支持的方法见下表，感觉 <code class="language-plaintext highlighter-rouge">[assertTrue(x)](https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertTrue)</code> 和 <code class="language-plaintext highlighter-rouge">assertRaises(Exception)</code> 包打一切</li>
  <li>作为 <code class="language-plaintext highlighter-rouge">'__main__'</code> 运行，运行的是自带的函数 <code class="language-plaintext highlighter-rouge">unittest.main()</code>。</li>
  <li>运行时需要 python 指明脚本的文件名。安装了 nose2 这个库的话，可以直接运行 <code class="language-plaintext highlighter-rouge">python -m nose2</code>, 它会自动寻找所有的测试依次运行。（后面发现 <code class="language-plaintext highlighter-rouge">unittest</code> 好像也有自动发现功能）</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Checks that</th>
      <th>New in</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertEqual">unittest.TestCase.assertEqual</a></td>
      <td>a == b</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertNotEqual">unittest.TestCase.assertNotEqual</a></td>
      <td>a != b</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertTrue">unittest.TestCase.assertTrue</a></td>
      <td>bool(x) is True</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertFalse">unittest.TestCase.assertFalse</a></td>
      <td>bool(x) is False</td>
      <td> </td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertIs">unittest.TestCase.assertIs</a></td>
      <td>a is b</td>
      <td>3.1</td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertIsNot">unittest.TestCase.assertIsNot</a></td>
      <td>a is not b</td>
      <td>3.1</td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertIsNone">unittest.TestCase.assertIsNone</a></td>
      <td>x is None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertIsNotNone">unittest.TestCase.assertIsNotNone</a></td>
      <td>x is not None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertIn">unittest.TestCase.assertIn</a></td>
      <td>a in b</td>
      <td>3.1</td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertNotIn">unittest.TestCase.assertNotIn</a></td>
      <td>a not in b</td>
      <td>3.1</td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertIsInstance">unittest.TestCase.assertIsInstance</a></td>
      <td>isinstance(a, b)</td>
      <td>3.2</td>
    </tr>
    <tr>
      <td><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertNotIsInstance">unittest.TestCase.assertNotIsInstance</a></td>
      <td>not isinstance(a, b)</td>
      <td>3.2</td>
    </tr>
  </tbody>
</table>

<h3 id="文档测试-1">文档测试</h3>

<p><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017605739507840">https://www.liaoxuefeng.com/wiki/1016959663602400/1017605739507840</a></p>

<p>Python 的文档测试用的是 <code class="language-plaintext highlighter-rouge">doctest</code> 库，写法如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Simple dict but also support access as x.y style.
</span><span class="gp">
    &gt;&gt;&gt;</span> <span class="n">d1</span> <span class="o">=</span> <span class="nc">Dict</span><span class="p">()</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d1</span><span class="p">[</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d1</span><span class="p">.</span><span class="n">x</span>
    <span class="mi">100</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d1</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d1</span><span class="p">[</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">]</span>
    <span class="mi">200</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span> <span class="o">=</span> <span class="nc">Dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span><span class="p">.</span><span class="n">c</span>
    <span class="sh">'</span><span class="s">3</span><span class="sh">'</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span><span class="p">[</span><span class="sh">'</span><span class="s">empty</span><span class="sh">'</span><span class="p">]</span>
    <span class="nc">Traceback </span><span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="bp">...</span>
    <span class="nb">KeyError</span><span class="p">:</span> <span class="sh">'</span><span class="s">empty</span><span class="sh">'</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d2</span><span class="p">.</span><span class="n">empty</span>
    <span class="nc">Traceback </span><span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="bp">...</span>
    <span class="nb">AttributeError</span><span class="p">:</span> <span class="sh">'</span><span class="s">Dict</span><span class="sh">'</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="sh">'</span><span class="s">empty</span><span class="sh">'</span>
    <span class="sh">'''</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">AttributeError</span><span class="p">(</span><span class="sa">r</span><span class="sh">"'</span><span class="s">Dict</span><span class="sh">'</span><span class="s"> object has no attribute </span><span class="sh">'</span><span class="s">%s</span><span class="sh">'"</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">doctest</span>
    <span class="n">doctest</span><span class="p">.</span><span class="nf">testmod</span><span class="p">()</span>
</code></pre></div></div>

<p>在保持 docstring 缩进的前提下，<code class="language-plaintext highlighter-rouge">&gt;&gt;&gt;</code>  开头的注释会被当作测试运行，紧随其后的行将作为对比基准。只有当预期报错的时候，可以用 <code class="language-plaintext highlighter-rouge">...</code> 省略中间的报错信息。</p>

<h3 id="集成测试-1">集成测试</h3>

<p>也可以用 <code class="language-plaintext highlighter-rouge">unittest</code> 完成。</p>

<p>和单元测试的区别在于，一般来说需要构建测试数据集等等。这需要重写 <code class="language-plaintext highlighter-rouge">unittest.TestCase.setup()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TestComplexData</span><span class="p">(</span><span class="n">unittest</span><span class="p">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># load test data
</span>        <span class="n">self</span><span class="p">.</span><span class="n">app</span> <span class="o">=</span> <span class="nc">App</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="sh">'</span><span class="s">fixtures/test_complex.json</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_customer_count</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">customers</span><span class="p">),</span> <span class="mi">10000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_existence_of_customer</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="nf">get_customer</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">9999</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="sa">u</span><span class="sh">"</span><span class="s">バナナ</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">address</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 Red Road, Akihabara, Tokyo</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="p">.</span><span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>
    
        </main>
        <div class="giscus" style="margin-bottom: 2em;"><script src="https://giscus.app/client.js"
        data-repo="MountAye/comments"
        data-repo-id="R_kgDOJe4FmQ"
        data-category="BLOG"
        data-category-id="DIC_kwDOJe4Fmc4CWQuC"
        data-mapping="title"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script></div>
        <div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1920275466226790"
     crossorigin="anonymous"></script>
<!-- blog-header -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1920275466226790"
     data-ad-slot="4291489170"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
      </div>
      <aside id="right" class="layout-right">
        <div id="toc-side-container" class="right-toc">
          <div class="overflow-y">
            <div id="toc-side">
              <div class="fade-out-right"></div>
            </div>
          </div>
          <div class="fade-out-bottom"></div>
        </div>
        <div class="right-navbar">
          <a class="right-nav-button" href="https://mountaye.github.io/blog/history">
            <span class="material-symbols-outlined">calendar_month</span>
            <span class="right-nav-text">日期归档</span>
          </a>
          <a class="right-nav-button" href="https://mountaye.github.io/blog/topics" >
            <span class="material-symbols-outlined">bookmarks</span>
            <span class="right-nav-text">话题归档</span>
          </a>
          <a class="right-nav-button" href="/blog/articles/Python-test-notes">
            <span class="material-symbols-outlined">language_pinyin</span>
            <span class="right-nav-text">简体中文</span>
          </a>
          <a class="right-nav-button" href="/blog/en/articles/Python-test-notes">
            <span class="material-symbols-outlined">language_us</span>
            <span class="right-nav-text">English</span>
          </a>
        </div>
      </aside>
      <!--  -->
    </div>
    <footer id="nav-mobile">
      <a class="nav-mobile-item" href="https://mountaye.github.io/blog/history">
        <span class="material-symbols-outlined">calendar_month</span>
      </a>
      <a class="nav-mobile-item" href="https://mountaye.github.io/blog/topics" >
        <span class="material-symbols-outlined">bookmarks</span>
      </a>
      <a class="nav-mobile-item" href="https://mountaye.github.io/blog/"><div class="nav-mobile-avatar"></div></a>
      <a class="nav-mobile-item" href="/blog/articles/Python-test-notes">
        <span class="material-symbols-outlined">language_pinyin</span>
      </a>
      <a class="nav-mobile-item" href="/blog/en/articles/Python-test-notes">
        <span class="material-symbols-outlined">language_us</span>
      </a>
    </footer>
  </body>
</html>