<!DOCTYPE html>
<!--
Material HTML5 Template (https://naveenshaji.github.io/material)
The MIT License (MIT)

Copyright (c) 2015 Naveen Shaji

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
-->

<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>.py Fedora 上安装 CPU 版 pytorch | 阿掖山：一个博客</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content=".py Fedora 上安装 CPU 版 pytorch" />
<meta name="author" content="MountAye" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="import torch (as tf)" />
<meta property="og:description" content="import torch (as tf)" />
<link rel="canonical" href="https://mountaye.github.io/blog/articles/install-pytorch-cpu-on-fedora" />
<meta property="og:url" content="https://mountaye.github.io/blog/articles/install-pytorch-cpu-on-fedora" />
<meta property="og:site_name" content="阿掖山：一个博客" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-13T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content=".py Fedora 上安装 CPU 版 pytorch" />
<script type="application/ld+json">
{"dateModified":"2021-10-13T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mountaye.github.io/blog/articles/install-pytorch-cpu-on-fedora"},"url":"https://mountaye.github.io/blog/articles/install-pytorch-cpu-on-fedora","author":{"@type":"Person","name":"MountAye"},"@type":"BlogPosting","headline":".py Fedora 上安装 CPU 版 pytorch","description":"import torch (as tf)","datePublished":"2021-10-13T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="description" content="智力活动是一种生活态度">
    <meta name="viewport" content="width=device-width, initial-scale=0.9, user-scalable=0">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="/blog/css/materialize.min.css" media="screen,projection" />
    <link rel="stylesheet" href="/blog/css/main.css">
    <link rel="canonical" href="https://mountaye.github.io/blog/articles/install-pytorch-cpu-on-fedora">
    <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <script type="text/javascript" src="/blog/js/jquery.min.js"></script>
    <script src="/blog/js/jquery.nicescroll.min.js"></script>
    <script src="/blog/js/jquery.nicescroll.plus.js"></script>
    <script src="/blog/js/velocity.min.js"></script>
    <script src="/blog/js/skrollr.min.js"></script>
    <script src="/blog/js/jquery.scrolline.js"></script>
    <script type="text/javascript" src="/blog/js/modernizr.js"></script>
    <script type="text/javascript" src="/blog/js/materialize.min.js"></script>
    <script type="text/javascript" src="/blog/js/main.js"></script>
    <link rel="alternate" type="application/rss+xml" title="阿掖山：一个博客" href="/blog/feed.xml" />
    <link rel="shortcut icon" href="/blog/assets/img/favicon.ico" >
</head>

  <body class="blue lighten-5"> 
    <div class="preloader blue container-fluid row">
      <div class="white-text text-darken-4 xpretext"><h4>阿掖山：一个博客</h4></div>
      <div class="progress blue lighten-2 xpreloading">
        <div class="indeterminate blue darken-3"></div>
      </div>
    </div> 
    <header class="site-header">
  <div class="navbar-fixed">
    <nav class="blue darken-2 waves-effect waves-light">
      <div class="nav-wrapper">
        <div class="container">
          <a href="/blog/" class="brand-logo">
            <i class="mdi-communication-chat"></i>
            阿掖山：一个博客
          </a>
          <ul id="nav-mobile" class="right side-nav">
            <li><a href="/blog/History/">历史</a></li>
            <li><a href="/blog/Topics/">分类</a></li>
            <li><a href="/blog/Comments/">留言</a></li>
            <li><a href="/blog/Links/">友链</a></li>
            <li><a href="/blog/About/">关于</a></li>
          </ul>
          <a class="button-collapse" href="#" data-activates="nav-mobile"><i class="mdi-navigation-menu"></i></a>
        </div>
      </div>
    </nav>
  </div>
</header>

    <a class="darken-2 scrollToTop btn-floating btn-large waves-effect waves-light blue"><i class="mdi-hardware-keyboard-arrow-up"></i></a>
    <div id="page-wrap">
      <div id="main-content">
        <div id="guts">
          <div class="container">
            <div class="wrapper text-darken-3">
              <div id="skrollr-body">
  <div class="post container paper card" style="margin-top: 8em; margin-bottom: 5em;">
    <header class="post-header">
      <h1 class="post-title">.py | Fedora 上安装 CPU 版 pytorch</h1>
      <p class="post-meta">Oct 13, 2021</p>
    </header>
    <article class="post-content">
        <p>马上要参加一个暑期学校，关于深度学习在显微图像处理当中的应用。</p>

<p>深度学习是机器学习的一个分支，机器学习中的绝大多数数据都可以抽象为向量（一阶张量），绝大多数的算法都可以分解为向量之间的运算，或者对向量的变换，表示为矩阵（二阶张量）。这就对张量计算相关算法的库函数产生了很大的需求。PyTorch 和 TensorFlow，还有其他的一些库，比如 Keras，Caffe 等等等等，都是为此而生。早期版本的 pytorch 和 tensorflow 有很大的区别，但是随着版本的迭代，两者逐渐兼并和挤掉了其他的竞争者，两者的相似之处也越来越多，“变成了自己曾经最讨厌的样子”。lol</p>

<p>不知道课上究竟要使用哪种机器学习的框架，所以决定把 PyTorch 和 TensorFlow 全都安装了（摊手）。正好可以接着上一篇的 <a href="/blog/articles/python-interpreter-editor-virtualenv">python 教程</a> 往下写。</p>

<p>先说一下自己的软硬件环境：Intel 家的 CPU 和集成显卡（玩不了《文明6》）。虽然不在官方支持 Linux 的名单上，但是自己安装了 Fedora，内核更新了几次之后已经没有了兼容性问题。python 版本 3.9.6，包管理器是 pip，编辑器是 vscode。</p>

<h2 id="建立虚拟环境">建立虚拟环境</h2>

<p>为什么要建立虚拟环境的问题本系列的前一篇已经回答过了，这次直接开干。我给两个虚拟环境分别取名为 <code class="language-plaintext highlighter-rouge">torch</code> 和<code class="language-plaintext highlighter-rouge">tf</code> 。关于命令行部分的代码，为了表示各个虚拟环境，特别加上了命令提示符<code class="language-plaintext highlighter-rouge">(env)[me@mycomputer]$</code>，抄代码的时候注意去掉。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>me@mycomputer]<span class="nv">$ </span>mkvirtualenv torch
<span class="o">(</span>torch<span class="o">)[</span>me@mycomputer]<span class="err">$</span>
</code></pre></div></div>

<h2 id="安装">安装</h2>

<p>在 PyTorch 官网，找到自己的硬件配制对应的安装命令：<a href="https://pytorch.org/get-started/locally/">https://pytorch.org/get-started/locally/</a>。比如我的就是 <code class="language-plaintext highlighter-rouge">Stable</code>&gt;<code class="language-plaintext highlighter-rouge">Linux</code>&gt;<code class="language-plaintext highlighter-rouge">Pip</code>&gt;<code class="language-plaintext highlighter-rouge">Python</code>&gt;<code class="language-plaintext highlighter-rouge">CPU</code>。把生成的命令复制到命令行：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">(</span>torch<span class="o">)[</span>me@mycomputer]<span class="nv">$ </span>pip3 <span class="nb">install </span><span class="nv">torch</span><span class="o">==</span>1.9.1+cpu <span class="nv">torchvision</span><span class="o">==</span>0.10.1+cpu <span class="nv">torchaudio</span><span class="o">==</span>0.9.1 <span class="nt">-f</span> https://download.pytorch.org/whl/torch_stable.html
</code></pre></div></div>

<p>等待各种提示信息显示安装完成。</p>

<h2 id="验证和退出">验证和退出</h2>

<p>按照 <a href="https://pytorch.org/get-started/locally/#linux-verification">官网给出的方法</a>，验证安装是否成功：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># tensor([[0.3799, 0.4494, 0.4296],
#       [0.5800, 0.0180, 0.3110],
#       [0.9847, 0.0125, 0.2648],
#       [0.0296, 0.3142, 0.9266],
#       [0.3192, 0.9645, 0.5545]])
</span></code></pre></div></div>

<p>为了下一步安装 tensorflow，先要退出到默认的虚拟环境：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">(</span>torch<span class="o">)[</span>me@mycomputer]<span class="nv">$ </span>deactivate
<span class="o">[</span>me@mycomputer]<span class="err">$</span>
</code></pre></div></div>

<h2 id="说好的-tensorflow-呢">说好的 TensorFlow 呢</h2>

<p>本来这篇文章是打算把  pytorch 和 tensorflow 一起写了，结果 tensorflow 实在是不给力。</p>

<ul>
  <li>直接安装</li>
</ul>

<p>在 <a href="https://www.tensorflow.org/install">TensorFlow 的官网</a>上方导航栏找到 install 按钮，然后在页面左侧找到 package/pip，<a href="https://www.tensorflow.org/install/pip#3.-install-the-tensorflow-pip-package">安装命令</a>也是只有一句话</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">tensorflow</span>
</code></pre></div></div>

<p>然而不行，虽然安装过程中没有报错，但是验证安装的时候报出一堆错误。</p>

<p>报错信息里有一句 <code class="language-plaintext highlighter-rouge">Could not load dynamic library 'libcudart.so.11.0'</code>，怀疑上面命令安装的是 GPU 版本。</p>

<ul>
  <li>安装 CPU 版本</li>
</ul>

<p>在网页正文的“Package Location”一节找到了 CPU 版本的安装文件：<code class="language-plaintext highlighter-rouge">https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow_cpu-2.6.0-cp39-cp39-manylinux2010_x86_64.whl</code>，于是删除虚拟环境、重建虚拟环境、重新安装。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">(</span>tf<span class="o">)[</span>me@mycomputer]<span class="nv">$ </span>deactivate
<span class="o">[</span>me@mycomputer]<span class="nv">$ </span>rmvirtualenv tf
<span class="o">[</span>me@mycomputer]<span class="nv">$ </span>mkvirtualenv tf
<span class="o">(</span>tf<span class="o">)[</span>me@mycomputer]<span class="nv">$ </span>pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip
<span class="o">(</span>tf<span class="o">)[</span>me@mycomputer]<span class="nv">$ </span>pip <span class="nb">install </span>https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow_cpu-2.6.0-cp39-cp39-manylinux2010_x86_64.whl
</code></pre></div></div>

<p>运行官方提供的测试之后依然会有警告信息：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">(</span>tf<span class="o">)</span> <span class="o">[</span>shixing@yoga-laptop ~]<span class="nv">$ </span>python <span class="nt">-c</span> <span class="s2">"import tensorflow as tf;print(tf.reduce_sum(tf.random.normal([1000, 1000])))"</span>
20XX-XX-XX XX:XX:XX.XXXXXX: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library <span class="o">(</span>oneDNN<span class="o">)</span> to use the following CPU instructions <span class="k">in </span>performance-critical operations:  AVX2 AVX512F FMA
To <span class="nb">enable </span>them <span class="k">in </span>other operations, rebuild TensorFlow with the appropriate compiler flags.
tf.Tensor<span class="o">(</span><span class="nt">-1338</span>.4773, <span class="nv">shape</span><span class="o">=()</span>, <span class="nv">dtype</span><span class="o">=</span>float32<span class="o">)</span>
</code></pre></div></div>

<p><a href="https://stackoverflow.com/questions/47068709/your-cpu-supports-instructions-that-this-tensorflow-binary-was-not-compiled-to-u">stackoverflow 的这个回答</a> 说，需要从源码编译 tensorflow，具体的方法在<a href="https://www.tensorflow.org/install/source#linux">官网也有</a>，但是实在是太麻烦了，<del>（还是鸽了）</del> 下次单独写成一篇吧。</p>

    </article>
    <br/><br/><br/>
  </div>
  <div class="comment container paper card" style="margin-bottom: 10em;">
    <h2>读者评论</h2><br>
    <div class="center" style="margin: auto; width: 80%;">
    <script src="https://giscus.app/client.js"
            data-repo="MountAye/blog"
            data-repo-id="R_kgDOGc3UIA"
            data-category="Comments"
            data-category-id="DIC_kwDOGc3UIM4CAI4h"
            data-mapping="title"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-theme="light"
            data-lang="zh-CN"
            crossorigin="anonymous"
            async>
    </script>
</div>
    <!-- <div class="row">
  <div class="col s8">
    <ul class="tabs blue z-depth-1">
      <li class="waves-effect tab col s3 blue darken-1"><a class="white-text text-darken-4 active" href="#markdown">Markdown</a></li>
      <li class="waves-effect tab col s3 blue darken-1"><a class="white-text text-darken-4" href="#preview">Preview</a></li>
    </ul>
  </div>
  <br><br><br>
  <div id="markdown" class="col s8">
    <div class="row">
      <form class="col s12">
        <div class="row blue-text">
          <div class="input-field col s12">
            <input id="first_name" type="text" class="validate materialize-textarea blue-text text-darken-3">
            <label for="first_name" class="blue-text text-darken-3">Title</label>
          </div>
          <div class="input-field col s12 blue-text">
            <textarea id="textarea1" class="materialize-textarea blue-text text-darken-3"></textarea>
            <label for="textarea1" class="blue-text text-darken-3">Enter comment</label>
          </div>
        </div>
      </form>
    </div>
    <button class="blue darken-1 white-text text-darken-3 waves-effect waves-cyan waves-light btn" href="/"><i class="mdi-action-backup"></i> &nbsp; Log in to comment</button>
  </div>
  <div id="preview" class="col s12">
    hhhh
  </div>
</div> -->
    <br><br><br>
  </div>
</div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 
<footer class="page-footer blue darken-2">
  <div class="container">
    <div class="row">
      
      <div class="col l3 m6 s12">
        <h5 class="white-text">social-links</h5>
        <ul>
          <li><a class="grey-text text-lighten-3" href="http://facebook.com/xSF.AzraeL/" target="_blank"><i class="mdi-social-person-add"></i> Facebook</a></li>
          <li><a class="grey-text text-lighten-3" href="https://plus.google.com/u/0/114363400342894379257/posts" target="_blank"><i class="mdi-social-plus-one"></i> Google+</a></li>
          <li><a class="grey-text text-lighten-3" href="http://github.com/naveenshaji/" target="_blank"><i class="mdi-notification-adb"></i> GitHub</a></li>
        </ul>
      </div>
             
      <div class="col l3 m6 s12">
      <h5 class="white-text">where-i-live</h5>
      <p class="grey-text text-lighten-4">TC 11/1827<br>West Cliff Gardens 35<br>Kowdiar, Trivandrum<br>&nbsp;</p>
      </div>
      
      <div class="col l3 m6 s12">
        <h5 class="white-text">contact-me</h5>
        <p class="grey-text text-lighten-4">+91-9496-74-7070<br>naveen@pixelblenders.com<br>xsf.azrael@gmail.com</p>
      </div>

                         
      <div class="col l3 m6 s12">
        <h5 class="white-text">MountAye</h5>
        <p class="grey-text text-lighten-4">MountAye: A Blog</p>
      </div>


    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
      © 2021 MountAye
      <a class="grey-text text-lighten-4 right" href="http://mountaye.github.io/" target="_blank">MountAye</a>
    </div>
  </div>
</footer> -->

  </body>
</html>
